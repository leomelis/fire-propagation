<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/jquery-migrate-1.1.1.min.js"></script>
    <script type="text/javascript" src="raphael-min.js"></script>

    <!-- Fix rendering issue -->
    <style> svg {shape-rendering: crispEdges; } </style>

    <script>
        var paper;

        var horizontal_size = 100;
        var vertical_size = 100;
        var dim = 10;

        var ox = 10;
        var oy = 50;
        var wind_strength = 30;
        var wind_direction = 0;
        var wind_amplitude = 90;


        var paper_width  = horizontal_size*dim;
        var paper_height = vertical_size*dim;

        var colors = {
            "fire":"red",
            "firewall":"black",
            "tree":"yellow",
            "pine":"green"
        }

        function fix_y(y){
            return paper_height - y - dim;
        }

        function create_grid(paper_width, paper_height, dim){
            for(var i=0; i<paper_height+dim; i=i+dim){
                paper.path("M0," + i + "L"+paper_width+"," + i);
            }

            for(var i=0; i<paper_width+dim; i=i+dim){
                paper.path("M"+i+",0L"+i+","+paper_height);
            }
        }

        function create_square(x, y, type){
            x = x*dim;
            y = fix_y(y*dim);

            var c = paper.rect(x, y, dim, dim);
            c.attr("fill", colors[type]);
        }

        function propagate_fire(x, y, v){
            for (i=-v; i<v+1; i++){
                for(j=-v; j<v+1; j++){
                    x_ = x+i;
                    y_ = y+j;

                    alpha = wind_direction;
                    beta = wind_amplitude;
                    alpha_lower = alpha - beta/2;
                    alpha_upper = alpha + beta/2;

                    gamma = Raphael.angle(x_, y_, x, y);

                    // boolean
                    inside_wind =   ((alpha_lower     <= gamma) && (gamma <= alpha_upper)) ||
                                    ((alpha_lower+360 <= gamma) && (gamma <= alpha_upper+360)) ||
                                    ((alpha_lower-360 <= gamma) && (gamma <= alpha_upper-360));

                    // boolean
                    inside_circle = Math.sqrt(i*i + j*j) <= v;

                    if (inside_wind && inside_circle){
                        create_square(x+i, y+j,"fire");
                    }
                }
            }
        }

        $(document).ready(function(){
            paper = Raphael(10, 50, paper_width, paper_height);
            propagate_fire(ox, oy, wind_strength);
            create_square(ox, oy, "firewall");
        });
    </script>
</head>
<body>
</body>
</html>